{"version":3,"sources":["globals.ts","jster.ts","shiny.ts","index.ts"],"names":[],"mappings":"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","file":"shinyjster.js","sourceRoot":"../../../srcjs","sourcesContent":["interface ShinyType {\n  setInputValue: (key: string, value: string | Record<string, any>) => void;\n  addCustomMessageHandler: (key: string, fn: (val: string | number) => void) => void;\n}\n\ndeclare global {\n  interface Window {\n    Shiny: ShinyType;\n    jQuery: JQueryStatic;\n    jster: (timeout: number) => void\n  }\n}\n\nconst Shiny: ShinyType = window.Shiny;\n\nconst jQuery: JQueryStatic = window.jQuery;\n\nexport { Shiny, jQuery, jQuery as $ };\n","import { Shiny } from \"./globals\";\n\ninterface ResolveFnType {\n  (value?: any): void;\n}\ninterface AddFnType {\n  (resolve: ResolveFnType, value?: any): void;\n}\n\nclass Jster {\n  timeout: number;\n  fns: Array<{ fn: Function; timeout: number }>;\n  p: null | Promise<any>;\n\n  constructor(timeout: number) {\n    this.timeout = timeout;\n    this.fns = [];\n    this.p = new Promise((resolve) => {\n      resolve(true);\n    });\n  }\n\n  add(fn: AddFnType, timeout: number = this.timeout): void {\n    this.fns.push({\n      fn: fn,\n      timeout: timeout,\n    });\n  }\n\n  setupPromises(): Promise<any> {\n    // for each fn\n    this.fns.forEach(({ fn, timeout }) => {\n      this.p = this.p\n        // delay a little bit\n        .then((value) => {\n          return new Promise((resolve) => {\n            setTimeout(function() {\n              resolve(value);\n            }, timeout);\n          });\n        })\n        // call the fn itself\n        .then((value) => {\n          return new Promise((resolve) => {\n            if ($) {\n              $(\"#shinyjster_progress\").text(`${ $(\"#shinyjster_progress\").text() } .`)\n            }\n            fn(resolve, value);\n          });\n        });\n    });\n\n    return this.p;\n  }\n\n  test(setInputValue = Shiny.setInputValue): void {\n    this.setupPromises().then(\n      (value) => {\n        setInputValue(\"jster_done\", {\n          type: \"success\",\n          length: this.fns.length,\n          value: value,\n        });\n      },\n      (error) => {\n        // print to console the same error\n        setTimeout(function() {\n          throw error;\n        }, 0);\n\n        setInputValue(\"jster_done\", {\n          type: \"error\",\n          length: this.fns.length,\n          error: error,\n        });\n      }\n    );\n  }\n}\n\n\nfunction jster(timeout = 250): Jster {\n  return new Jster(timeout);\n}\n\n\nexport { Jster, jster };\n","import { Shiny, $ } from \"./globals\";\n\nfunction initJsterHooks() {\n  // use event.target to obtain the output element\n  Shiny.addCustomMessageHandler('shinyjster_msg_close_window', function (ignore) {\n    setTimeout(() => {\n      console.log(\"shinyjster: - closing window!\")\n      window.close()\n    }, 500)\n    Shiny.setInputValue(\"jster_closing_window\", \"closing\");\n  });\n}\n\n\nexport {initJsterHooks}\n","// import \"babel-polyfill\";\n\nimport { jster } from \"./jster\";\nimport { initJsterHooks } from \"./shiny\";\n\n\n\nwindow.jster = jster;\n\ninitJsterHooks()\n\n\n// // export { jster };\n// export default jster;\n"]}